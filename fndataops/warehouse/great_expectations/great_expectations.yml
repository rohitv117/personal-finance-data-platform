# Great Expectations configuration file
config_version: 3.0

# Datasources
datasources:
  finops_postgres:
    class_name: SqlAlchemyDatasource
    connection_string: postgresql://finops_user:finops_password@postgres:5432/finops
    introspection:
      whole_table:
        class_name: WholeTableIntrospector
    tables:
      raw_transactions:
        class_name: Table
        schema_name: raw
        table_name: transactions
      staging_transactions:
        class_name: Table
        schema_name: staging
        table_name: transactions
      mart_cashflow_daily:
        class_name: Table
        schema_name: marts
        table_name: mart_cashflow_daily

# Expectations store
expectations_store_name: expectations_store

# Validations store
validations_store_name: validations_store

# Evaluation parameter store
evaluation_parameter_store_name: evaluation_parameter_store

# Checkpoint store
checkpoint_store_name: checkpoint_store

# Profiler store
profiler_store_name: profiler_store

# Stores
stores:
  expectations_store:
    class_name: ExpectationsStore
    store_backend:
      class_name: TupleFilesystemStoreBackend
      base_directory: expectations/
  
  validations_store:
    class_name: ValidationsStore
    store_backend:
      class_name: TupleFilesystemStoreBackend
      base_directory: validations/
  
  evaluation_parameter_store:
    class_name: EvaluationParameterStore
    store_backend:
      class_name: TupleFilesystemStoreBackend
      base_directory: evaluation_parameters/
  
  checkpoint_store:
    class_name: CheckpointStore
    store_backend:
      class_name: TupleFilesystemStoreBackend
      base_directory: checkpoints/
  
  profiler_store:
    class_name: ProfilerStore
    store_backend:
      class_name: TupleFilesystemStoreBackend
      base_directory: profilers/

# Data docs
data_docs_sites:
  local_site:
    class_name: SiteBuilder
    store_backend:
      class_name: TupleFilesystemStoreBackend
      base_directory: data_docs/local_site/
    site_index_builder:
      class_name: DefaultSiteIndexBuilder

# Validation operators
validation_operators:
  action_list_operator:
    class_name: ActionListValidationOperator
    action_list:
      - name: store_validation_result
        action:
          class_name: StoreValidationResultAction
      - name: send_slack_notification_on_failure
        action:
          class_name: SlackNotificationAction
          slack_webhook: ${SLACK_WEBHOOK}
          notify_on: failure
          notify_with: all
          renderer:
            module_name: great_expectations.render.renderer.slack_renderer
            class_name: SlackRenderer

# Notebooks
notebooks:
  - name: create_expectations
    class_name: CreateExpectationsNotebook
    module_name: great_expectations.notebook_runner
  - name: edit_expectations
    class_name: EditExpectationsNotebook
    module_name: great_expectations.notebook_runner
  - name: validate_data
    class_name: ValidateDataNotebook
    module_name: great_expectations.notebook_runner

# Config variables
config_variables:
  # Add any config variables here
  postgres_connection_string: postgresql://finops_user:finops_password@postgres:5432/finops
  warehouse_path: /opt/airflow/warehouse 